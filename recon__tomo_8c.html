<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>MAOS: maos/recon_tomo.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="maos.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MAOS
   </div>
   <div id="projectbrief">Multithreaded Adaptive Optics Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('recon__tomo_8c.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">recon_tomo.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Setup tomography parameters.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a51b7a9c320bb9b58fc5632da0a44ab84"><td class="memItemLeft" align="right" valign="top"><a id="a51b7a9c320bb9b58fc5632da0a44ab84"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TIMING</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a51b7a9c320bb9b58fc5632da0a44ab84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8426a146b24c93e9cc460df348c79ed"><td class="memItemLeft" align="right" valign="top"><a id="ac8426a146b24c93e9cc460df348c79ed"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TIC_tm</b></td></tr>
<tr class="separator:ac8426a146b24c93e9cc460df348c79ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8346642868c1576597ad637b746e9257"><td class="memItemLeft" align="right" valign="top"><a id="a8346642868c1576597ad637b746e9257"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>tic_tm</b></td></tr>
<tr class="separator:a8346642868c1576597ad637b746e9257"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00b7822255d82d13b2ca313db43a139a"><td class="memItemLeft" align="right" valign="top"><a id="a00b7822255d82d13b2ca313db43a139a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>toc_tm</b>(A)</td></tr>
<tr class="separator:a00b7822255d82d13b2ca313db43a139a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a829971036b353f363b9f6d171279a530"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__tomo_8c.html#a829971036b353f363b9f6d171279a530">setup_recon_tomo_reg</a> (<a class="el" href="maos_2types_8h.html#structrecon__t">recon_t</a> *recon, const <a class="el" href="parms_8h.html#structparms__t">parms_t</a> *parms)</td></tr>
<tr class="separator:a829971036b353f363b9f6d171279a530"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a734c26f3d555e9e8038c196ad0a242ef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__tomo_8c.html#a734c26f3d555e9e8038c196ad0a242ef">setup_recon_tomo_matrix</a> (<a class="el" href="maos_2types_8h.html#structrecon__t">recon_t</a> *recon, const <a class="el" href="parms_8h.html#structparms__t">parms_t</a> *parms)</td></tr>
<tr class="separator:a734c26f3d555e9e8038c196ad0a242ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f2768cd129f8ee65be72b2a4741ab91"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__tomo_8c.html#a3f2768cd129f8ee65be72b2a4741ab91">setup_recon_tomo</a> (<a class="el" href="maos_2types_8h.html#structrecon__t">recon_t</a> *recon, const <a class="el" href="parms_8h.html#structparms__t">parms_t</a> *parms, const <a class="el" href="maos_2types_8h.html#structpowfs__t">powfs_t</a> *powfs)</td></tr>
<tr class="separator:a3f2768cd129f8ee65be72b2a4741ab91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1429c8b70e161f91770d3fdbc88a4942"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__tomo_8c.html#a1429c8b70e161f91770d3fdbc88a4942">Tomo_nea_gpt</a> (Tomo_T *data, int nthread, int gpt)</td></tr>
<tr class="separator:a1429c8b70e161f91770d3fdbc88a4942"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1b2e85b187dfdb4a027936f18b4e5f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__tomo_8c.html#aa1b2e85b187dfdb4a027936f18b4e5f1">TomoR</a> (<a class="el" href="type_8h.html#structdcell">dcell</a> **xout, const void *A, const <a class="el" href="type_8h.html#structdcell">dcell</a> *gin, const real alpha)</td></tr>
<tr class="separator:aa1b2e85b187dfdb4a027936f18b4e5f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a060ae9b2bc6a20378d32564512e04f2a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__tomo_8c.html#a060ae9b2bc6a20378d32564512e04f2a">TomoRt</a> (<a class="el" href="type_8h.html#structdcell">dcell</a> **gout, const void *A, const <a class="el" href="type_8h.html#structdcell">dcell</a> *xin, const real alpha)</td></tr>
<tr class="separator:a060ae9b2bc6a20378d32564512e04f2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcd22c411fbceae27ccf7e14309077f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recon__tomo_8c.html#afcd22c411fbceae27ccf7e14309077f5">TomoL</a> (<a class="el" href="type_8h.html#structdcell">dcell</a> **xout, const void *A, const <a class="el" href="type_8h.html#structdcell">dcell</a> *xin, const real alpha)</td></tr>
<tr class="separator:afcd22c411fbceae27ccf7e14309077f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Setup tomography parameters. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a829971036b353f363b9f6d171279a530"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a829971036b353f363b9f6d171279a530">&#9670;&nbsp;</a></span>setup_recon_tomo_reg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_recon_tomo_reg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="maos_2types_8h.html#structrecon__t">recon_t</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="parms_8h.html#structparms__t">parms_t</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Regularization terms for tomography. Can be called multiple times for Cn2 update. </p>

</div>
</div>
<a id="a734c26f3d555e9e8038c196ad0a242ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a734c26f3d555e9e8038c196ad0a242ef">&#9670;&nbsp;</a></span>setup_recon_tomo_matrix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_recon_tomo_matrix </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="maos_2types_8h.html#structrecon__t">recon_t</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="parms_8h.html#structparms__t">parms_t</a> *&#160;</td>
          <td class="paramname"><em>parms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>assemble tomography matrix. In CG mode, this function is not executed if tomo.assemble=0, Instead, the algorithm is contained in recon.c. When you modify anything, make sure you also do it there.</p>
<p>For integrated tomograhy:</p>
<p>\(\hat{x}=(G_{lgs}^{T}C_{lgs}^{-1}G_{lgs}+C_{x}^{-1}+G_{ngs}^{T}C_{ngs}^{-1} G_{ngs})^{-1}(G_{lgs}^{T}C_{lgs}^{-1}s_{lgs}+G_{ngs}^{T}C_{ngs}^{-1}s_{ngs}){\equiv}RL^{-1}RR s.\)</p>
<p>For split tomography, the terms regarding NGS are dropped:</p>
<p>\(\hat{x}_{lgs}=(G_{lgs}^{T}C_{lgs}^{-1}G_{lgs}+C_{x}^{-1})^{-1} G_{lgs}^{T}C_{lgs}^{-1}s_{lgs}\equiv R_L^{-1} R_R s.\)</p>
<p>The left hand side of linear equation (inside the inverse) is stored in RL. The right hand side of the linear equation (outside of the inverse) is stored in RR. The terms regarding the NGS are handled using low rank terms. The gradients from LGS and NGS and concatenated to \(s\).</p>
<p>In the LGS part, there is a global tip/tilt removal operator because LGS is insensitive to global tip/tilts.</p>
<p>For details see www.opticsinfobase.org/abstract.cfm?URI=josaa-19-9-1803 </p>

</div>
</div>
<a id="a3f2768cd129f8ee65be72b2a4741ab91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f2768cd129f8ee65be72b2a4741ab91">&#9670;&nbsp;</a></span>setup_recon_tomo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_recon_tomo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="maos_2types_8h.html#structrecon__t">recon_t</a> *&#160;</td>
          <td class="paramname"><em>recon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="parms_8h.html#structparms__t">parms_t</a> *&#160;</td>
          <td class="paramname"><em>parms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="maos_2types_8h.html#structpowfs__t">powfs_t</a> *&#160;</td>
          <td class="paramname"><em>powfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets up the tomogrpahy turbulence reconstruction structs including wavefront reconstructor and DM fitting operator</p>
<p>Calls <a class="el" href="recon__tomo_8c.html#a734c26f3d555e9e8038c196ad0a242ef">setup_recon_tomo_matrix()</a> and setup_recon_fit_matrix() to setup the tomography and DM fitting matrix.</p>
<p>AHST is handled in setup_ngsmod().</p>
<p>MVST is handled in <a class="el" href="maos_2recon_8h.html#a14b7a0beadfd04a65affccf99767892b">setup_recon_mvst()</a>.</p>
<p>MOAO is handled in <a class="el" href="maos_2moao_8h.html#aa581aa15f1584934c554970b31eeb2fb">setup_recon_moao()</a>. </p>

</div>
</div>
<a id="a1429c8b70e161f91770d3fdbc88a4942"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1429c8b70e161f91770d3fdbc88a4942">&#9670;&nbsp;</a></span>Tomo_nea_gpt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Tomo_nea_gpt </td>
          <td>(</td>
          <td class="paramtype">Tomo_T *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nthread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gpt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Apply NEA weighting with optional Gp' gg = GP' * NEAI * gg; </p>

</div>
</div>
<a id="aa1b2e85b187dfdb4a027936f18b4e5f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1b2e85b187dfdb4a027936f18b4e5f1">&#9670;&nbsp;</a></span>TomoR()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TomoR </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="type_8h.html#structdcell">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="type_8h.html#structdcell">dcell</a> *&#160;</td>
          <td class="paramname"><em>gin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const real&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Apply tomography right hand operator without using assembled matrix. Fast and saves memory. The operation is the same as the Tomo_nea_gpt and Tomo_iprop in TomoL, so merge the implemenations.</p>
<p>xout=HXW'<em>GP'*NEAI</em>(1-TTF*PTTF)*gin. </p>

</div>
</div>
<a id="a060ae9b2bc6a20378d32564512e04f2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a060ae9b2bc6a20378d32564512e04f2a">&#9670;&nbsp;</a></span>TomoRt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TomoRt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="type_8h.html#structdcell">dcell</a> **&#160;</td>
          <td class="paramname"><em>gout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="type_8h.html#structdcell">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const real&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Transpose operation of TomoRt. From xout -&gt; gin </p>

</div>
</div>
<a id="afcd22c411fbceae27ccf7e14309077f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcd22c411fbceae27ccf7e14309077f5">&#9670;&nbsp;</a></span>TomoL()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TomoL </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="type_8h.html#structdcell">dcell</a> **&#160;</td>
          <td class="paramname"><em>xout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="type_8h.html#structdcell">dcell</a> *&#160;</td>
          <td class="paramname"><em>xin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const real&#160;</td>
          <td class="paramname"><em>alpha</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Apply tomography left hand side operator without using assembled matrix. Fast and saves memory. Only useful in CG. Accumulates to xout;</p>
<p>Some timing information: Generated in T410s with Intel Core i5 520 M @ 2.4 GHz (1 T is 1 thread, 2 T is 2 thread) and Poweredge with dual Xeon X5355 2.66Ghz (1 P is 1 thread, 8 P is 8 thread) Time 1 T 2 T 1 P 8 P HXW: 7.8 5.4 7.7 5.0 GP: 4.3 2.6 3.6 1.4 remove_mode: 0.3 0.3 0.4 0.6 neai: 0.5 0.3 0.5 0.4 GP': 3.2 2.1 3.4 1.0 HXW': 5.5 4.7 7.4 4.9 cxx: 3.2 2.5 3.5 2.7 </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->

   </ul>
 </div>
</body>
</html>
