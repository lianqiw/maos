<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>MAOS: sim.conf</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="maos.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MAOS
   </div>
   <div id="projectbrief">Multithreaded Adaptive Optics Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('sim.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">sim.conf </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="fragment"><div class="line">#FILE sim.conf</div><div class="line">#Contains common parameters to all setups. </div><div class="line">#Telescope Aperture Configuration.</div><div class="line">aper.d     = [30 3.6] #may contain one for [d] or two numbers for [d din]. d is</div><div class="line">              #outer diameter. din is optimal inner hole diameter.</div><div class="line">aper.fnamp    = &quot;TMT_23cm6.bin&quot; #The amplitude map contains a cell array</div><div class="line">                  # of 2 elements.  The first element is 5x1 vector,</div><div class="line">                  # specifying sampling dx, dy, origin coordinate ox, oy and</div><div class="line">                  # height (0).  The second element is a NxN square array.</div><div class="line"></div><div class="line">aper.rotdeg   = 0     #Telescope pupil rotation CCW with respect to instrument. </div><div class="line">aper.pupmask  =       #Instrument pupil mask</div><div class="line">#defines simulation parameters.</div><div class="line">sim.seeds     = [1]   #random seeds. a list. 0 means random seed</div><div class="line">sim.start     = 0     #first time step. usually 0.</div><div class="line">sim.end       = 500   #last time step (exclusive)</div><div class="line">sim.closeloop = 1     #closed loop simulation</div><div class="line">sim.dt        = 1/600 #loop sampling time. (WFS integration time). 20200930</div><div class="line">sim.dtrat_skip= 0     #drop frame every this steps (sim.dt). 0 no drop.</div><div class="line">sim.zadeg     = 0     #zenith angle. moved from atm.zadeg</div><div class="line">sim.htel      = 4000  #height of telescope. Adjust sodium profile altitude by this.</div><div class="line">sim.cachedm   = 4     #Caching DM commands to fine sampled grids </div><div class="line">                  #=1: sampling is dm.dx/4. &gt;3: sampling is dm.dx/sim.cachedm.</div><div class="line">sim.fov       = 120   #The entire FoV diameter in arcsec. Only used during plotting.</div><div class="line">#Servo coefficients. There is two cycle delay.</div><div class="line">#A is command. e is error signal. at time step n, the command is updated by</div><div class="line">#A(n)=A(n-1)*apdm(0)+A(n-2)*apdm(1)+...+e(n-2)*ep</div><div class="line">sim.aphi      = 1 #this is the default. [0.5 0.5] is used in laos </div><div class="line">sim.ephi      = 0.5   #error gain of high order loop.</div><div class="line">sim.alhi      = 0     #Additional latency (sim.dt) of the high order loop. </div><div class="line">                  #End to end latency is (powfs[hi].dtrat+1+alhi)*sim.dt</div><div class="line">sim.aplo      = ref:sim.aphi #ap for low order control. See sim.aphi</div><div class="line">sim.eplo      = ref:sim.ephi #error gain of low order modes. See sim.ephi</div><div class="line">sim.allo      = ref:sim.alhi #Additional latency (sim.dt) of the lo order loop. See sim.alhi</div><div class="line">                  #End to end latency is (powfs[lo].dtrat+1+allo)*sim.dt</div><div class="line">sim.fuseint   = 1     #use fused integrator. for high and low order loop.</div><div class="line">sim.fcttm     = 20    #Cross over frequency of T/T split between DM and TTM (20)*/</div><div class="line">#Focus tracking gains.</div><div class="line">sim.fcfocus   = inf   #cross-over frequency of the focus LPF. lpfocus=2*pi*fc/fs where fs is AO sampling frequency. </div><div class="line">                  #-1 means 1/10 of NGS frame rate. inf means remove LGS focus completely</div><div class="line">sim.mffocus   = -1     #method for focus tracking. </div><div class="line">                  #0: disable focus update. </div><div class="line">              #1: Focus tracking using closed loop gradients, for each LGS independently. (preferred)</div><div class="line">              #2: Focus tracking using closed loop graidnets, for common LGS focus only.</div><div class="line">              #-1: auto. 1 for LGS.</div><div class="line">#Focus offloading to telescope</div><div class="line">sim.focus2tel = 0     #Offload focus to telescope</div><div class="line">sim.epfocus2tel=0.01  #Integrator gain for telescope focus control</div><div class="line">#Uplink laser pointing servo #TODO: This belongs to LGS. TODO: Migrate to powfs</div><div class="line">sim.apfsm     = ref:sim.aphi #[0.5 0.5] is used in laos. See sim.aphi</div><div class="line">sim.epfsm     = ref:sim.ephi #uplink integrator gain. See sim.ephi</div><div class="line">sim.alfsm     = ref:sim.alhi #Additional latency (sim.dt) of the uplink loop. See sim.alhi</div><div class="line">                  #End to end latency is (powfs.dtrat+1+alfsm)*sim.dt. </div><div class="line">sim.commonfsm = 0     #Make FSM for each powfs common (single FSM in LLT for LGS WFS).</div><div class="line">sim.idealfsm  = 0     #ideal correction on uplink (debugging)</div><div class="line">sim.zetafsm   = 1     #Damping of FSM modeled as second harmonic oscillater (SHO).</div><div class="line">sim.f0fsm     = 0     #Resonance frequency of FSM (SHO). 0: infinite.</div><div class="line">#Twfs</div><div class="line">sim.aptwfs    = 1     #Leak should be small if eptwfs is small.</div><div class="line">sim.eptwfs    = 0.05  #Twfs reference vector servo gain.</div><div class="line">sim.eptsph    = 0.5   #Twfs reference vector servo gain for spherical mode</div><div class="line">#Other</div><div class="line">sim.skysim    = 0     #enable presimulation for sky coverage.</div><div class="line">sim.wspsd     =       #Telescope wind shake PSD input. Nx2. First column is freq</div><div class="line">              #in Hz, Second column is PSD in rad^2/Hz.</div><div class="line">sim.wsseq     = 1     #windshake sequency. different wsseq gives different realizations</div><div class="line">sim.ncpa_calib= 1     #calibrate NCPA. Only useful if surf is not empty. </div><div class="line">              #1: use all DMs. 2: use only ground dm</div><div class="line">sim.ncpa_ttr  = 0     #Remove average t/t from NCPA for WFS. Equivalent as repositioning WFS.</div><div class="line">sim.ncpa_thetax= []   #Coordinate for NCPA calibration (arcsec). empty means follow evl.</div><div class="line">sim.ncpa_thetay= []   #Coordinate for NCPA calibration (arcsec)</div><div class="line">sim.ncpa_wt    = []   #Weight for each point.</div><div class="line">sim.ncpa_hs    = []   #Height of star</div><div class="line">sim.dmadd     = &quot;&quot;    #file containing dm vector to simulate turbulence (added to integrator output). </div><div class="line">                  # #DM cells. In each cell, one colume is for each time step. Wraps over in the end. Can be empty.</div><div class="line">sim.pause     = 0     #Pause after every step</div><div class="line">#for GPU</div><div class="line">gpu.wfs       = 1     #Use GPU for WFS sensing</div><div class="line">gpu.evl       = 1     #Use GPU for Performance evaluation</div><div class="line">gpu.tomo      = 1     #Use GPU for tomography</div><div class="line">gpu.fit       = 1     #Use GPU for DM fitting</div><div class="line">gpu.lsr       = 1     #Use GPU for LSR</div><div class="line">gpu.psf       = 1     #Use GPU to accumulate PSF.</div><div class="line">gpu.moao      = 1     #Use GPU for MOAO</div><div class="line"></div><div class="line">#if mvmport is nonzero connect to the mvm server at mvmhost:mvmport.</div><div class="line">sim.mvmhost   = &quot;localhost&quot; #Where does the MVM server run</div><div class="line">sim.mvmport   = 0     #which port does the MVM server run. 0: disable mvm server/client</div><div class="line">sim.mvmsize   = 0     #number of gradients to send each time. 0 is all.</div><div class="line">sim.mvmngpu   = 0     #&gt;0: limit maximum number of gpus to use.      </div><div class="line">#For special purpose</div><div class="line">sim.noatm     = 0     #Disable atmosphere generation (to evaluate telescope errors).</div><div class="line">sim.evlol     = 0     #evaluate open loop performance only. Skip wfs/tomo/recon.</div><div class="line">sim.psfr      = 0     #Save PSF reconstruction telemetry.</div><div class="line">sim.ecnn      = 0     #Estimate WF covariance due to WFS noise cov Cnn.</div><div class="line">sim.wfsalias  = 0     #Study the wfs aliasing effect by project turbulence onto</div><div class="line">                  #the orthogonal of the DM vector space.</div><div class="line">sim.idealfit  = 0     #evaluation ideal fit error only. no wfs, no recon. (was fitonly)</div><div class="line">sim.idealtomo = 0     #ideal tomography without wfs (directly propagate from turbulence).</div><div class="line">sim.idealwfs  = 0     #Implements ideal WFS by only using turbulence in DM range. conflicts sim.wfsalias</div><div class="line">sim.idealevl  = 0     #Evaluate the performance only in DM range.</div><div class="line"></div><div class="line"></div><div class="line">#Common atmospheric parameters</div><div class="line">atm.method    = 0     #0: Von Karman. 1: Fractal method. 2: Biharmonic. </div><div class="line">atm.size      = [64 64]#size of atmosphere in meter. 0: automatic.</div><div class="line">atm.dx        = 1/64  #sampling of the atmosphere, match evl.dx</div><div class="line">atm.wdrand    = 1     #&gt;0: as additional seed to randomize wind direction </div><div class="line">atm.frozenflow= 1      #using frozen flow screen (at OL. CL is always frozenflow)</div><div class="line">atm.ninit     = 17    #Initial size of the screen in fractal method. &gt;=2</div><div class="line">atm.share     = 1     #We share atmosphere by default.</div><div class="line">atm.r0evolve  = 0     #0: disable. 1: Scale turbulence screen spatially by r0logpsds, 2) Scale Raytracing using r0logpsdt, 3) both.</div><div class="line">atm.r0logpsdt = [-1.43 3.353e-4 0 0.3107] #[alpha beta fmin fmax]:temporal PSD of log(r0) /Hz: beta*f^alpha. Or a file of nx2</div><div class="line">atm.r0logpsds = [-2.43 5.195e-5 0 1/30] #[alpha beta fmin fmax]:spatial PSD of log(r0) /Hz: beta*f^alpha. Or a file of nx2</div><div class="line">#Reconstructor parameters</div><div class="line">atmr.dx       = 0   #Fundemental reconstructio grid sampling. 0: matching</div><div class="line">            #minimum of actuator spacing and subaperture size.</div><div class="line">atmr.r0z      = ref:atm.r0z  #atm r0 at zenith. -1: matches atm.r0z</div><div class="line">atmr.L0       = ref:atm.L0  #atm outer scale.  -1: matches atm.l0</div><div class="line">atmr.os       = [2]  #reconstruction screen oversampling over atmr.dx</div><div class="line">atmr.ht       = ref:atm.ht #reconstructed screen height. Empty meaning follow atm.ht (MCAO)</div><div class="line">atmr.wt       = ref:atm.wt #reconstructed screen weight. Empty meaning follow atm.wt (MCAO)</div><div class="line"></div><div class="line">#CN2 Estimation</div><div class="line">cn2.pair      = []    #pairs of wfs to estimate cn2. empty to disable cn2 estimation.</div><div class="line">cn2.step      = 100   #do cn2 estimation every this time step</div><div class="line">cn2.reset     = 0     #reset the accumulated cn2 after every cn2.reset set of results</div><div class="line">cn2.hmax      = 18000 #maximum height to esimate at zenith</div><div class="line">cn2.saat      = 0.95  #subaperture area threashold to use in cn2 estimation</div><div class="line">cn2.keepht    = 1     #1: Interpolate slodar results onto atmr.ht. 2: do slodar directly on these layers.</div><div class="line">cn2.tomo      = 0     #1: update tomography parameters </div><div class="line">cn2.verbose   = 1     #output estimated r0, cn2 during simulation</div><div class="line">cn2.nhtomo    = 6     #number of layers to feed into reconstructor. only effective if keepht==0</div><div class="line">cn2.psol      = 1     #1: use pseudo open loop gradients. 0: to probe residual turbulence</div><div class="line">cn2.moveht    = 0     #move the ht used for reconstructor to near strongest layers. only</div><div class="line">                      #effective if keepht=0.</div><div class="line"></div><div class="line">#set MOAO DMs parameters. See dm.* for definition</div><div class="line">moao.dx       = [0.5] #spacing of actuator</div><div class="line">moao.iac      = [0.223] </div><div class="line">moao.gdm      = [0.5] #low pass filter gain on MOAO DM command.</div><div class="line">moao.stroke   = [inf]</div><div class="line">moao.actslave = [0]</div><div class="line">moao.lrt_ptt  = [0]</div><div class="line">moao.guard    = [1]</div><div class="line">moao.actstuck = [&quot;&quot;]</div><div class="line">moao.actfloat = [&quot;&quot;]</div><div class="line">moao.ar       = [1]</div><div class="line">#some common fov parameters</div><div class="line">evl.dx      = ref:atm.dx  #sampling of the aperture in simulation. -1: follow atm.dx</div><div class="line">evl.psf     = [1] #output psf for this direction if psf is computed. 1 or nevl elements.</div><div class="line">evl.psfr    = [1] #output psf reconstruction telemetry for this direction.</div><div class="line">evl.hs      = [inf] #the height of the science object. normally infinity. </div><div class="line">evl.rmax    = 1   #max radial order in performance evaluation. </div><div class="line">           #1: includes piston/tip/tilt. 2: p/t/t/focus/astigmatism</div><div class="line">evl.tomo    = 0 #evaluate CL error for tomography</div><div class="line">evl.moao    = -1 #index into MOAO config in recon.conf</div><div class="line">evl.psfhist = 0 #output history of the complex psf (a lot of storage). </div><div class="line">evl.psfmean = 0 #output time averaged psf. for this number of psf&#39;&#39;s along the</div><div class="line">        #way. 1: only save in the end. n: save  average every n steps (no reset after saving)</div><div class="line">evl.psfol   = 0 #compute OL psf in additional to CL PSF. 0: disable 1: on axis</div><div class="line">            #direction only, 2: all directions and average them.</div><div class="line">evl.psfngsr = 0 #remove NGS modes from PSF in split tomography mode. </div><div class="line">            # 1: both normal psf and psf with ngsmod removal are saved.</div><div class="line">        # 2: only psf with ngs mode removed is computed.</div><div class="line">evl.cov     = 0 #save covariance of opd for directions for steps like evl.psfmean (no reset after saving)</div><div class="line">evl.opdmean =0 #save science opd time average every this time step if &gt;0.</div><div class="line">evl.wvl     = [1.25e-6 1.65e-6 2.2e-6]#wavelength to evaluat PSF or strehl</div><div class="line">evl.pttr    = [0] #remove p/t/t in wavefront OPD before computing PSF or covariance</div><div class="line">evl.psfisim = 20  #time step to start psfmean/psfhist</div><div class="line">evl.psfgridsize = [] #FFT grid size for psf computation for each</div><div class="line">             #wavelength. 0,1,or nwvl number of elements. 0:</div><div class="line">             #automatic. This determines the sampling of the computed</div><div class="line">             #PSF. length matches evl.wvl</div><div class="line">evl.psfsize = []    #size of the psf to output. The large PSF is cut to this</div><div class="line">            #size. Set to 1 to compute strehl only. 1 or nwvl number of</div><div class="line">            #elements(for each wvl)</div><div class="line"></div><div class="line">#some common DM parameters that are usually the same for each DM. Can take either 1 or ndm values.</div><div class="line">dm.dx     = [0.5]  #spacing of DM actuators. preferred way to set system order as 2014-04-03. Only way since 2016.</div><div class="line">dm.ar     = [1]    #DM aspect ratio. dy/dx spacing</div><div class="line">dm.guard  = [1]    #extra DM actuator rings in actuator grid. default: 1</div><div class="line">dm.stroke = [inf]  #surface stroke in meter. opd is [-stroke stroke]</div><div class="line">dm.iastroke=[inf]  #surface inter-actuator stroke in meter. </div><div class="line">dm.iastrokefn=[]</div><div class="line">dm.iac    = [0.223] #inter-actuator-coupling coefficient for cubic influence function. 0: disable. 4/29/2019: updated from 0.3</div><div class="line">dm.hist   = [0]    #output histogram of DM actuator commands.</div><div class="line">dm.histbin= [1e-7] #The bin size for DM histogram computation.</div><div class="line">dm.histn  = [201]  #Total number of bins. odd number, centered around zero.</div><div class="line">dm.vmisreg= [0]    #vertical misregistration. not implemented yet.</div><div class="line">dm.hyst   = [0]   #DM model hysteresis amount (ratio) </div><div class="line">dm.hyst_alpha=[2] #The DM model hysteresis alpha parameter</div><div class="line">dm.hyst_stroke=[10e-6] #The surface stroke that the hysteresis is measured at</div><div class="line">dm.actfloat = [&quot;&quot;] #file containing floating actuators. nx2 coordinate</div><div class="line">dm.actstuck = [&quot;&quot;] #file containing stuck actuators. nx2 coordinate. or nx3 with third column the stuck position (in opd).</div><div class="line">#All misregistrations/distortions are specified here</div><div class="line">misreg.tel2wfs=[] #From telescope pupil (atmosphere) to WFS</div><div class="line">misreg.dm2wfs=[] #From DM to WFS</div><div class="line">misreg.dm2sci=[] #From DM to science.</div><div class="line">misreg.pupil=[0 0]  #2 numbers only. Misregistration of pupil wrt to AO and instrument.</div><div class="line"></div><div class="line">surf=[]          #Simulating surfaces like the telescope or NCPA.</div><div class="line">                 #Each file contains a dmat array with the following key in header.</div><div class="line">                 #dx: the sampling along x and y direction (must be the same)</div><div class="line">                 #ox,oy: the origin along x and y direction</div><div class="line">                 #h: height of the surface from pupil.  </div><div class="line">                 #Important: The OPD should cover more area (1/2 meter each side) than meta pupil for interpolation.</div><div class="line"></div><div class="line">tsurf=[]         #Simulating surfaces on M3 that is tilted in converging beam</div><div class="line">                 #Each file contains a dmat array of surface map (NOT OPD)</div><div class="line">                 #with the following key in header.</div><div class="line">                 #dx,dy: the sampling along x and y direction, </div><div class="line">                 #ox,oy: the origin along x and y direction, </div><div class="line">                 #txdeg: the x tilt angle in degree wrt beam (90 is prep), </div><div class="line">                 #tydeg: the y tilt angle in degree wrt beam (90 is prep), </div><div class="line">                 #ftel: The telescope effective focal length, </div><div class="line">                 #fexit: the distance between the exit pupil and the focus, </div><div class="line">                 #fsurf: the distance between the M3 and the focus.</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->

   </ul>
 </div>
</body>
</html>
