<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>MAOS: Algorithms</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="maos.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MAOS
   </div>
   <div id="projectbrief">Multithreaded Adaptive Optics Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('algorithm.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Algorithms </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sect-dm-actuator"></a>
DM Actuator Influence Function</h1>
<h2><a class="anchor" id="autotoc_md40"></a>
Linear influence function</h2>
<p>The linear influence function is defined as </p><p class="formulaDsp">
\[ h(x;x_{i};\delta)=\begin{cases} 1-|x-x_{i}|/\sigma &amp; \textrm{if }|x-x_{i}|\leq\delta\\ 0 &amp; \textrm{else} \end{cases} \]
</p>
<p> where \(\delta\) is usually equal to the grid spacing. A bilinear influence function is simply the product of two linear influence functions with variables \(x_{1}\)and \(x_{2}\).</p>
<h2><a class="anchor" id="autotoc_md41"></a>
Cubic influence function</h2>
<p>A cubic influence function that can reproduce piston/tip/tilt is coined by Ellerbroek to model the piezo stack DM actuator. The influence has the form </p><p class="formulaDsp">
\[ h(x;x_{i};\delta)=h_{0}((x-x_{i})/\delta) \]
</p>
<p> where \(\delta\) is the same as the grid spacing, and \(h_{0}\) is the influence function defined in the normalized coordinates </p><p class="formulaDsp">
\[ h_{0}(x)=\frac{1}{1+2c}\begin{cases} 1+(4c-\frac{5}{2})|x|^{2}+(\frac{3}{2}-3c)|x|^{3} &amp; |x|\leq1\\ (2c-\frac{1}{2})(2-|x|)^{2}+(\frac{1}{2}-c)(2-|x|)^{3} &amp; 1&lt;|x|\leq2\\ 0 &amp; |x|&gt;2 \end{cases} \]
</p>
<p> where c is the nearest neighbor coupling frequency. The leading coefficient is to normalize the influence function so that it sums to 1.</p>
<h1><a class="anchor" id="hysteresis"></a>
DM Hysteresis</h1>
<p>The DM hysteresis modeling is based on "Modeling the hysteresis of a scanning probe microscope" J. Vac. Sci. Technol. B 18 (2), Mar/Apr 2000</p>
<p>Formula (2) is used with V replaced by command x, and x replaced by actual DM position y </p><p class="formulaDsp">
\[ \frac{dy}{dx}=\alpha sign(dx) (\beta x-y)+(\beta-u) \]
</p>
<p>For closed hyteresis loop within the stroke limit \(S\), the linear ordinary differential equation can be solved analytically: </p><p class="formulaDsp">
\begin{eqnarray*} y_{t/r}(x)=\beta x \mp \frac{u}{\alpha}\left(1-\frac{2\exp(\mp\alpha x)}{\exp(-\alpha S)+\exp(\alpha S)}\right) \end{eqnarray*}
</p>
<p>where t and r represents trace and retrace directions. It is desirable to have y be within the same range as x to simulate calibrated command:</p>
<p>\(y_{t/r}(S)=S\). Let the hysteresis ratio be \(h\), we have</p>
<p class="formulaDsp">
\begin{eqnarray*} \frac{y_r(0)}{S}&amp;=&amp;\frac{u}{\alpha S}\left(1-\frac{2}{\exp(-\alpha S)+exp(\alpha S)}\right)=h \\ \frac{y_{t/r}(S)}{S}&amp;=&amp;\beta-\frac{u}{\alpha S}\left(1-\frac{2\exp(-\alpha S)}{\exp(-\alpha S)+\exp(\alpha S)}\right) = 1 \end{eqnarray*}
</p>
<p>The equation can be solved uniquely when \(\alpha S\) is fixed. The hysteresis curve is a weak function of \(\alpha S\) and having \(\alpha S=2\) produces a good looking curve. Smaller \(\alpha S\) has slower convergence of the hysteresis curve.</p>
<p>The hysteresis model is simulated using simple integration. For each step with a new x, the position y is updated as </p><p class="formulaDsp">
\begin{eqnarray*} dx &amp;=&amp; x-x_{last} \\ dy &amp;=&amp; \alpha*abs(dx)*(\beta*x_{last}-y_{last})+dx*(\beta-u) \\ y_{last}&amp;\mathrel{+}=&amp;dy \\ x_{last}&amp;=&amp;x \\ y&amp;=&amp;y_{last} \end{eqnarray*}
</p>
<h1><a class="anchor" id="pop"></a>
Physical Optics Beam Propagation</h1>
<h2><a class="anchor" id="autotoc_md42"></a>
Maxwell Equation</h2>
<p>The Maxwell equation predicts that</p>
<p class="formulaDsp">
\[ \nabla^2 \mathbf{E} = \mu_0 \epsilon_0 \frac{\partial^2 \mathbf{E}}{\partial t^2} \]
</p>
<p>where \({\mu}_0{\epsilon}_0=1/{c}_0^2\)</p>
<p>It has a general solution of the form</p>
<p class="formulaDsp">
\[\mathbf{E}=\mathbf{E_0}f(\hat{\mathbf{k}}\cdot{\mathbf{x}} - c_0 t)\]
</p>
<p> where \(\hat{\mathbf{k}}\) is the wave propagation direction. We have \(\mathbf{E}\cdot\hat{\mathbf{k}}=0\) and \(c_0\mathbf{B}=\hat{\mathbf{k}}\times \mathbf{E}\).</p>
<h2><a class="anchor" id="autotoc_md43"></a>
Fresnel diffraction integral</h2>
<p>The electric field at a point \((x,y,z)\) following an aperture at \(z=0\) is given by</p>
<p class="formulaDsp">
\[ E(x,y,z)=\frac{1}{i\lambda}\iint E(x^\prime, y^\prime, 0)\frac{e^{ikr}}{r} \frac{z}{r} dx^\prime dy^\prime \]
</p>
<p>where \(k=2\pi/\lambda\) is the wave number and \(r=\sqrt{(x-x^\prime)^2+(y-y^\prime)^2+z^2}\). This is the exact solution, but lacks analytical or convenient numerical solution.</p>
<h2><a class="anchor" id="autotoc_md44"></a>
Fresnel approximation</h2>
<p>Introduce \(\rho^2=(x-x^\prime)^2+(y-y^\prime)^2\), and substitute \(r\) with its Taylor expansion: </p><p class="formulaDsp">
\[r=\sqrt{\rho^2+z^2}=z\sqrt{1+\frac{\rho^2}{z^2}}=z+\frac{\rho^2}{2z}-\frac{\rho^4}{8z^3}+...\]
</p>
<p> The equation can be simplified if we can ignore the third term, which requires that the phase \(k\frac{\rho^4}{8z^3}\ll2\pi\) or </p><p class="formulaDsp">
\[z^3\gg\frac{\rho^4}{8\lambda}.\]
</p>
<p> For the \(r\) at the denominator (not within the exponential), we make another approximate by keeping only the first term, which is valid if the aperture is significantly smaller than the propagation distance: \(\rho\ll z\). The electric field can then be simplified as</p>
<p class="formulaDsp">
\[E(x,y,z)=\frac{e^{ikz}}{i\lambda z}\iint E(x^\prime, y^\prime,0){e^{\frac{i\pi}{z\lambda}[(x-x^\prime)^2+(y-y^\prime)^2]}} dx^\prime dy^\prime\]
</p>
<p>This is the Fresnel diffraction integral. It means that, if the Fresnel approximation is valid, the propagating field is a spherical wave, originating at the aperture and moving along z. The term before the integral represents constant phase evolution and energy normalization.</p>
<h3><a class="anchor" id="autotoc_md45"></a>
Angular Spectrum</h3>
<p>The integral can be viewed as a convolution between \(E(x,y,0)\) and </p><p class="formulaDsp">
\[h(x,y)=e^{\frac{i\pi}{z\lambda}(x^2+y^2)}.\]
</p>
<p>The convolution can be done with Fourier transform (there is no need for embedding): </p><p class="formulaDsp">
\[E=\mathcal{F}^{-1}[\mathcal{F}[E(x,y,0)]\mathcal{F}[h(x,y)]].\]
</p>
<p>The fourier transform of \(h(x,y)\) can be computed analytically. Recall the Fourier transform </p><p class="formulaDsp">
\[\mathcal{F}[\exp[ia(x^2+y^2)]]=\frac{i\pi}{a}\exp[\frac{-i\pi^2}{a}(f_x^2+f_y^2)]\]
</p>
<p> for \(k&gt;0\). We have </p><p class="formulaDsp">
\[\mathcal{F}[h(x,y)]=iz\lambda\exp[-iz\pi\lambda(f_x^2+f_y^2)].\]
</p>
<p> Using this requires upsampling since FFT convolution assumes the function is periodic. We do not use this method.</p>
<p>This convolution view is commonly referred to as the angular spectrum method. The original field \(E(x,y,0)\) is only FFT'ed once. For each propagation distance, the FFT of \(h()\) is multiplied to \(\hat{E}\) and then inverse FFT'ed to obtain the field. This approach is mostly useful in very near field propagations when \(x\) and \(x^\prime\) has the same sampling.</p>
<h3><a class="anchor" id="autotoc_md46"></a>
Single FFT</h3>
<p>The integral can also be rewritten as a single Fourier transform:</p>
<p class="formulaDsp">
\[E(x,y,z)=\frac{e^{ikz}}{i\lambda z} h(x,y)\iint E(x^\prime, y^\prime, 0){e^{\frac{i\pi}{z\lambda}[{x^\prime}^2+{y^\prime}^2]}}{e^{-i2\pi(\frac{x}{z\lambda}x^\prime+\frac{y}{z\lambda}y^\prime)}} dx^\prime dy^\prime\]
</p>
<p>Define a new function \(G(x^\prime, y^\prime)\) as </p><p class="formulaDsp">
\[G(x^\prime, y^\prime)=E(x^\prime, y^\prime, 0){e^{\frac{i\pi}{z\lambda}({x^\prime}^2+{y^\prime}^2)}}\]
</p>
<p> Its fourier transform is </p><p class="formulaDsp">
\[\hat{G}(p,q)=\mathcal{F}\{G(x^\prime,y^\prime)\}.\]
</p>
<p> We have \(p=\frac{x}{z\lambda}\) and \(q=\frac{y}{z\lambda}\) and </p><p class="formulaDsp">
\[E(x,y,z)=\frac{e^{ikz}}{i\lambda z} h(x,y) \hat{G}(\frac{x}{z\lambda},\frac{y}{z\lambda}).\]
</p>
<p>The FFT view is more suitable when the propagation is near far field as the FFT of \(G()\) gives coordinate in the angular space. Replace \(x,y\) by the angular coordinate \(p,q\) and renormalize the function to angular coordinate, we have</p>
<p class="formulaDsp">
\[ E(p,q,z)=h(p z \lambda, q z \lambda)\hat{G}(p,q)\]
</p>
<p>. The scaling of \(\frac{1}{z\lambda}\) is dropped due to change of variable and preservation of total energy. In numerical calculation, the sampling of \(p,q\) and \(x,y\) follows \(dp=1/(n*dx),dq=1/(n*dy)\) where \(n\) is the array dimension along \(x\) and \(y\).</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Fraunhofer approximation</h2>
<p>In a special case when the propagation is at far field (from pupil to focus or vice versa), so that \(z\gg\frac{\rho^2}{2\lambda}\) the extra phase term also be dropped:</p>
<p class="formulaDsp">
\[E(x,y,z)=\frac{1}{i\lambda z}e^{ikz}\iint E(x^\prime, y^\prime, 0){e^{-i2\pi(\frac{x}{z\lambda}x^\prime+\frac{y}{z\lambda}y^\prime)}} dx^\prime dy^\prime\]
</p>
<p>Replace \(x,y\) by angular coordinate \(p=\frac{x}{z\lambda},q=\frac{y}{z\lambda}\), ignore the constant phase, and renormalize the function to angular coordinate, we have </p><p class="formulaDsp">
\[E^\prime(p,q)=\hat{E}(p,q)\]
</p>
<p> and the energy is preserved via </p><p class="formulaDsp">
\[\iint{||E^\prime(p,q)||^2 dp dq}=\iint{||E(x,y,0)||^2dxdy}.\]
</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Sphere to sphere propagation</h2>
<p>When the wavefront at the starting aperture is highly curved, regular numerical solution may not be able to sample the wavefront sufficiently, resuling in poor numerical accuracy. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->

   </ul>
 </div>
</body>
</html>
