<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>MAOS: lib/zernike.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../maos.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MAOS
   </div>
   <div id="projectbrief">Multithreaded Adaptive Optics Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d8/d2d/zernike_8h.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">zernike.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6360bd013ee1ebf6e1459ddd6518d5db" id="r_a6360bd013ee1ebf6e1459ddd6518d5db"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d27/structdmat.html">dmat</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d2d/zernike_8h.html#a6360bd013ee1ebf6e1459ddd6518d5db">zernike</a> (const <a class="el" href="../../df/def/type_8h.html#da/ddc/structloc__t">loc_t</a> *loc, real D, int rmin, int rmax, int flag)</td></tr>
<tr class="separator:a6360bd013ee1ebf6e1459ddd6518d5db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39da367ec0cb13e0c1915da411ddd68c" id="r_a39da367ec0cb13e0c1915da411ddd68c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d27/structdmat.html">dmat</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d2d/zernike_8h.html#a39da367ec0cb13e0c1915da411ddd68c">zernike_cov_kolmogorov</a> (int nr)</td></tr>
<tr class="separator:a39da367ec0cb13e0c1915da411ddd68c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae97782b41c65bcfc49dd5535c1269277" id="r_ae97782b41c65bcfc49dd5535c1269277"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d27/structdmat.html">dmat</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d2d/zernike_8h.html#ae97782b41c65bcfc49dd5535c1269277">cov_vonkarman</a> (const <a class="el" href="../../df/def/type_8h.html#da/ddc/structloc__t">loc_t</a> *loc, const <a class="el" href="../../d3/d27/structdmat.html">dmat</a> *modz, real L0)</td></tr>
<tr class="separator:ae97782b41c65bcfc49dd5535c1269277"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4752aa8b5f24209a50ac01127878ce2f" id="r_a4752aa8b5f24209a50ac01127878ce2f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/def/type_8h.html#df/d47/structdcell">dcell</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d2d/zernike_8h.html#a4752aa8b5f24209a50ac01127878ce2f">cov_diagnolize</a> (const <a class="el" href="../../d3/d27/structdmat.html">dmat</a> *mz, const <a class="el" href="../../d3/d27/structdmat.html">dmat</a> *cov)</td></tr>
<tr class="separator:a4752aa8b5f24209a50ac01127878ce2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ad3af89781ee984fa623b98b31d81f7" id="r_a0ad3af89781ee984fa623b98b31d81f7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/def/type_8h.html#df/d47/structdcell">dcell</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d2d/zernike_8h.html#a0ad3af89781ee984fa623b98b31d81f7">KL_vonkarman_full</a> (const <a class="el" href="../../df/def/type_8h.html#da/ddc/structloc__t">loc_t</a> *loc, int ttr, real iac, real L0)</td></tr>
<tr class="separator:a0ad3af89781ee984fa623b98b31d81f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac84fe62d4211a6e5f9ae6a923b2b1c6e" id="r_ac84fe62d4211a6e5f9ae6a923b2b1c6e"><td class="memItemLeft" align="right" valign="top"><a id="ac84fe62d4211a6e5f9ae6a923b2b1c6e" name="ac84fe62d4211a6e5f9ae6a923b2b1c6e"></a>
<a class="el" href="../../d3/d27/structdmat.html">dmat</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>KL_vonkarman</b> (const <a class="el" href="../../df/def/type_8h.html#da/ddc/structloc__t">loc_t</a> *loc, int ttr, real L0)</td></tr>
<tr class="separator:ac84fe62d4211a6e5f9ae6a923b2b1c6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65ebc8583ba990204a26ce3d9fee1e88" id="r_a65ebc8583ba990204a26ce3d9fee1e88"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d27/structdmat.html">dmat</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d2d/zernike_8h.html#a65ebc8583ba990204a26ce3d9fee1e88">fft_mode</a> (const <a class="el" href="../../df/def/type_8h.html#da/ddc/structloc__t">loc_t</a> *loc, real D, real px, real py)</td></tr>
<tr class="separator:a65ebc8583ba990204a26ce3d9fee1e88"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6360bd013ee1ebf6e1459ddd6518d5db" name="a6360bd013ee1ebf6e1459ddd6518d5db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6360bd013ee1ebf6e1459ddd6518d5db">&#9670;&#160;</a></span>zernike()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d27/structdmat.html">dmat</a> * zernike </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../df/def/type_8h.html#da/ddc/structloc__t">loc_t</a> *&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>D</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create Zernike modes on loc with diameter D and radial order from rmin to rmax r=0 is piston r=1 is tip/tilt r=2 is quadratic modes if nopiston is set, skip piston mode. if flag is &gt;0, only radial mode is used. if flag is 0, all modes between rmin and rmax. if flag is &lt;0, only generate mode -flag. rmin and rmax is irrelevant set D to -|D| to avoid clipping points outside of D. </p>

</div>
</div>
<a id="a39da367ec0cb13e0c1915da411ddd68c" name="a39da367ec0cb13e0c1915da411ddd68c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39da367ec0cb13e0c1915da411ddd68c">&#9670;&#160;</a></span>zernike_cov_kolmogorov()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d27/structdmat.html">dmat</a> * zernike_cov_kolmogorov </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Covariance of zernike modes in Kolmogorov Turbulence. Only modes with the same m have non-zero covariance.</p>
<p>Based on Eq 3.14 in Adaptive Optics in Astronomy (Roddier 1999). Verified against values in J.Y.Wang 1978, table II(a,b).</p>
<p>Notice that (D/r0)^(5/3) has been factored out.</p>
<p>2015-06-05: This is not longer being used. It is inaccurate for annular pupil. Analytic calculation using the power spectrum is used instead. </p>

</div>
</div>
<a id="ae97782b41c65bcfc49dd5535c1269277" name="ae97782b41c65bcfc49dd5535c1269277"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae97782b41c65bcfc49dd5535c1269277">&#9670;&#160;</a></span>cov_vonkarman()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d27/structdmat.html">dmat</a> * cov_vonkarman </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../df/def/type_8h.html#da/ddc/structloc__t">loc_t</a> *&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d27/structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>modz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>L0</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute covariance matrix of modes in von Karman turbulence. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">loc</td><td>The location grid </td></tr>
    <tr><td class="paramname">modz</td><td>The modal matrix (zernike or zonal) </td></tr>
    <tr><td class="paramname">L0</td><td>The outer scale </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The mode coefficient covariance matrix</dd></dl>
<p>The turbulence OPD y can be expressed as \(y=M*x\) where \(x\) is the modal coefficient and \(M\) is the modal matrix (parameter modz). The OPD covariance \(&lt;yy&#39;&gt;\) can be expressed as followes: \(&lt;yy&#39;&gt;=M*&lt;xx&#39;&gt;*M&#39;\) where \(&lt;xx&#39;&gt;\) is the modal coefficient covariance matrix. We have \(M&#39;&lt;yy&#39;&gt;M=(M&#39;M)&lt;xx&#39;&gt;(M&#39;M)=CC&lt;xx&#39;&gt;CC\) where \(CC=(M&#39;M)\). Therefore \(&lt;xx&#39;&gt;=CC^{-1} M&#39;&lt;yy&#39;&gt;M CC^{-1}\)</p>
<p>The function first computes \(DD=M&#39;&lt;yy&#39;&gt;M\) with \(DD[i,j]=\sum_{k,m}
M[k,i]*yy[k,m]*M[m,j]\) which can be expressed in Fourier domain as \(DD=\sum_{k&#39;,m&#39;} Mhat[k&#39;,i] Mhat[m&#39;,j] \Phi[k&#39;,m&#39;]\) where \(\Phi\) is the turbulence power spectrum.</p>
<p>For modes \(M\) defined on the DM, its influence function should be includes. \(&lt;yy&#39;&gt;=H*M*&lt;xx&#39;&gt;*M&#39;H&#39;\). </p>

</div>
</div>
<a id="a4752aa8b5f24209a50ac01127878ce2f" name="a4752aa8b5f24209a50ac01127878ce2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4752aa8b5f24209a50ac01127878ce2f">&#9670;&#160;</a></span>cov_diagnolize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/def/type_8h.html#df/d47/structdcell">dcell</a> * cov_diagnolize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d3/d27/structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d27/structdmat.html">dmat</a> *&#160;</td>
          <td class="paramname"><em>cov</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Diagnolize the covariance matrix and transform the mode. Random vector is expressed as y=mod*x. Its covariance is &lt;yy'&gt;=mod*&lt;x*x'&gt;<em>mod=mod*cov*mod'; The covariance of the coefficient x can be decomposed with svd: cov=U*S*V'. So we have &lt;yy'&gt;=mod</em>&lt;x*x'&gt;*mod=mod*U*S*v'*mod'; Refine the bases with KL=mod*U, we have &lt;yy'&gt;=KL*S*KL' where the covariance of coefficient is diagonal S. returns the diagnolized mode and the covariance of each modal coefficient. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mod</td><td>Input mode  </td></tr>
    <tr><td class="paramname">cov</td><td>Covariance of modes </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0ad3af89781ee984fa623b98b31d81f7" name="a0ad3af89781ee984fa623b98b31d81f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ad3af89781ee984fa623b98b31d81f7">&#9670;&#160;</a></span>KL_vonkarman_full()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/def/type_8h.html#df/d47/structdcell">dcell</a> * KL_vonkarman_full </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../df/def/type_8h.html#da/ddc/structloc__t">loc_t</a> *&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ttr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>iac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>L0</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create Karhunen-Loeve modes for which each mode coefficient is statistically independent in von Karman spectrum.</p>
<p>The original method is to compute covariance of zernike modes in von Karman spectrum and diagnolize the covariance matrix. But this methods suffers for higher order systems because high order zernike modes are hard to generate on account of limited resolution of real precision floating point numbers. To make matters worse, to generate m KL modes, around 2*m Zernike modes are needed because each KL mode is a linear combination of all Zernike modes with same azimuthal (m) but higher radial (r) order. A work around of the precisiosn issue is to limit the absolute value of the zernike modes to within 100 to avoid excessive norm due to round off errors.</p>
<p>The new method is to use zonal modes (identity matrix). The advantage is that the zonal modes spans the whole range of possible modes and are straightforward to generate.</p>
<p>In theory, the KL modes computes should be independent on the starting mode, as long as the modes are independent and span the whole vector space for the coordinate. </p>

</div>
</div>
<a id="a65ebc8583ba990204a26ce3d9fee1e88" name="a65ebc8583ba990204a26ce3d9fee1e88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65ebc8583ba990204a26ce3d9fee1e88">&#9670;&#160;</a></span>fft_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d27/structdmat.html">dmat</a> * fft_mode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../df/def/type_8h.html#da/ddc/structloc__t">loc_t</a> *&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>D</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>px</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>py</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Generate FFT mode with period. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->

   </ul>
 </div>
</body>
</html>
