<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>MAOS: sys/daemonize.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../maos.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MAOS
   </div>
   <div id="projectbrief">Multithreaded Adaptive Optics Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('df/d59/daemonize_8h.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">daemonize.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a86fb6b4df27be38bfb1ad8af16c21c58" id="r_a86fb6b4df27be38bfb1ad8af16c21c58"><td class="memItemLeft" align="right" valign="top"><a id="a86fb6b4df27be38bfb1ad8af16c21c58" name="a86fb6b4df27be38bfb1ad8af16c21c58"></a>
#<a class="el" href="../../d0/d44/class_num_array.html">define</a>&#160;</td><td class="memItemRight" valign="bottom"><b>dummyfun</b>(A...)</td></tr>
<tr class="separator:a86fb6b4df27be38bfb1ad8af16c21c58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee375a410e4732c98fa384493dc394ad" id="r_aee375a410e4732c98fa384493dc394ad"><td class="memItemLeft" align="right" valign="top"><a id="aee375a410e4732c98fa384493dc394ad" name="aee375a410e4732c98fa384493dc394ad"></a>
#<a class="el" href="../../d0/d44/class_num_array.html">define</a>&#160;</td><td class="memItemRight" valign="bottom"><b>CACHE_FILE</b>(<a class="el" href="../../d0/d44/class_num_array.html">var</a>,  <a class="el" href="../../d0/d44/class_num_array.html">fn_cache</a>,  <a class="el" href="../../d0/d44/class_num_array.html">f_read</a>,  <a class="el" href="../../d0/d44/class_num_array.html">f_create</a>,  <a class="el" href="../../d0/d44/class_num_array.html">f_write</a>)</td></tr>
<tr class="separator:aee375a410e4732c98fa384493dc394ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a11717d53b875bab717d53dc7c280b1af" id="r_a11717d53b875bab717d53dc7c280b1af"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d59/daemonize_8h.html#a11717d53b875bab717d53dc7c280b1af">single_instance_daemonize</a> (<a class="el" href="../../d0/d44/class_num_array.html">const</a> char *<a class="el" href="../../d0/d44/class_num_array.html">lockfolder_in</a>, <a class="el" href="../../d0/d44/class_num_array.html">const</a> char *<a class="el" href="../../d0/d44/class_num_array.html">progname</a>, int version, <a class="el" href="../../d0/d44/class_num_array.html">void</a>(*<a class="el" href="../../d0/d44/class_num_array.html">daemon_func</a>)(<a class="el" href="../../d0/d44/class_num_array.html">void</a> *), <a class="el" href="../../d0/d44/class_num_array.html">void</a> *<a class="el" href="../../d0/d44/class_num_array.html">daemon_arg</a>)</td></tr>
<tr class="separator:a11717d53b875bab717d53dc7c280b1af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6acbb2f2605de7c5aaef9e4b4dd421c" id="r_ae6acbb2f2605de7c5aaef9e4b4dd421c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d59/daemonize_8h.html#ae6acbb2f2605de7c5aaef9e4b4dd421c">lock_file</a> (<a class="el" href="../../d0/d44/class_num_array.html">const</a> char *fn, int <a class="el" href="../../d0/d44/class_num_array.html">block</a>)</td></tr>
<tr class="separator:ae6acbb2f2605de7c5aaef9e4b4dd421c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cf440f7f061b747c2e06b0cef9f045b" id="r_a2cf440f7f061b747c2e06b0cef9f045b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d59/daemonize_8h.html#a2cf440f7f061b747c2e06b0cef9f045b">lock_file_version</a> (<a class="el" href="../../d0/d44/class_num_array.html">const</a> char *fn, int <a class="el" href="../../d0/d44/class_num_array.html">block</a>, int version)</td></tr>
<tr class="separator:a2cf440f7f061b747c2e06b0cef9f045b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29b0af1da2432bcc90721c0b62f4e660" id="r_a29b0af1da2432bcc90721c0b62f4e660"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d44/class_num_array.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d59/daemonize_8h.html#a29b0af1da2432bcc90721c0b62f4e660">daemonize</a> (<a class="el" href="../../d0/d44/class_num_array.html">void</a>)</td></tr>
<tr class="separator:a29b0af1da2432bcc90721c0b62f4e660"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39160bd731e78e9de1768b2bed9a06d3" id="r_a39160bd731e78e9de1768b2bed9a06d3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d44/class_num_array.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d59/daemonize_8h.html#a39160bd731e78e9de1768b2bed9a06d3">redirect</a> (<a class="el" href="../../d0/d44/class_num_array.html">void</a>)</td></tr>
<tr class="separator:a39160bd731e78e9de1768b2bed9a06d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7efd3a64d0b0853540f2403f926644a" id="r_aa7efd3a64d0b0853540f2403f926644a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d44/class_num_array.html">pid_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d59/daemonize_8h.html#aa7efd3a64d0b0853540f2403f926644a">launch_exe</a> (<a class="el" href="../../d0/d44/class_num_array.html">const</a> char *<a class="el" href="../../d0/d44/class_num_array.html">exepath</a>, <a class="el" href="../../d0/d44/class_num_array.html">const</a> char *<a class="el" href="../../d0/d44/class_num_array.html">cmd</a>)</td></tr>
<tr class="separator:aa7efd3a64d0b0853540f2403f926644a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcabfafcc9beaed3768dca78f4183695" id="r_afcabfafcc9beaed3768dca78f4183695"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d59/daemonize_8h.html#afcabfafcc9beaed3768dca78f4183695">find_exe</a> (<a class="el" href="../../d0/d44/class_num_array.html">const</a> char *name)</td></tr>
<tr class="separator:afcabfafcc9beaed3768dca78f4183695"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29e658343992b41840bc0b2f1d6d67df" id="r_a29e658343992b41840bc0b2f1d6d67df"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d59/daemonize_8h.html#a29e658343992b41840bc0b2f1d6d67df">spawn_process</a> (<a class="el" href="../../d0/d44/class_num_array.html">const</a> char *<a class="el" href="../../d0/d44/class_num_array.html">exename</a>, <a class="el" href="../../d0/d44/class_num_array.html">const</a> char *<a class="el" href="../../d0/d44/class_num_array.html">const</a> *<a class="el" href="../../d0/d44/class_num_array.html">args</a>, <a class="el" href="../../d0/d44/class_num_array.html">const</a> char *path)</td></tr>
<tr class="separator:a29e658343992b41840bc0b2f1d6d67df"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Handling process creation. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a11717d53b875bab717d53dc7c280b1af" name="a11717d53b875bab717d53dc7c280b1af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11717d53b875bab717d53dc7c280b1af">&#9670;&#160;</a></span>single_instance_daemonize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int single_instance_daemonize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">const</a> char *&#160;</td>
          <td class="paramname"><em>lockfolder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">const</a> char *&#160;</td>
          <td class="paramname"><em>progname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">void</a>(*)(<a class="el" href="../../d0/d44/class_num_array.html">void</a> *)&#160;</td>
          <td class="paramname"><em>daemon_func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">void</a> *&#160;</td>
          <td class="paramname"><em>daemon_arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Launch a singleton daemon. First try to create a lock file progname.pid in folder lockfolder_in. If lock failes, it means other daemon already exists, will not proceed. If lock succeed, will write pid and version in the file.</p>
<p>the stdin and stderr stream will then be directed to progname.log in folder lockfolder_in. buffering is disabled to ensure real time display by tail.</p>
<p>if daemon_func is true, will fork and run it with argument daemon_arg. otherwise the routine returns. </p>

</div>
</div>
<a id="ae6acbb2f2605de7c5aaef9e4b4dd421c" name="ae6acbb2f2605de7c5aaef9e4b4dd421c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6acbb2f2605de7c5aaef9e4b4dd421c">&#9670;&#160;</a></span>lock_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lock_file </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">const</a> char *&#160;</td>
          <td class="paramname"><em>fn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fn</td><td>The filename to lock on  </td></tr>
    <tr><td class="paramname">block</td><td>block on waiting. set to 0 for no waiting. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a2cf440f7f061b747c2e06b0cef9f045b" name="a2cf440f7f061b747c2e06b0cef9f045b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2cf440f7f061b747c2e06b0cef9f045b">&#9670;&#160;</a></span>lock_file_version()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lock_file_version </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">const</a> char *&#160;</td>
          <td class="paramname"><em>fnlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Ensure exclusive access by opening and maintaining lock of file fn.</p>
<p>Will proceed if the lock if succeed, in which case non-negative number of the fd is returned. If other process already locked, will return negative number. If version is specified and is bigger than the value contained in existing fnlock, will kill the old process that created fnlock.</p>
<p>returns: -PID (&lt;-1): if a running process already locked file -1: failed to lock fd (&gt;-1): successfully locked </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fnlock</td><td>The filename to lock on  </td></tr>
    <tr><td class="paramname">block</td><td>block on waiting. set to 0 for no waiting.  </td></tr>
    <tr><td class="paramname">version</td><td>The version of the software that locks the file, primarily for managing scheduler. May be zero. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a29b0af1da2432bcc90721c0b62f4e660" name="a29b0af1da2432bcc90721c0b62f4e660"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29b0af1da2432bcc90721c0b62f4e660">&#9670;&#160;</a></span>daemonize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d44/class_num_array.html">void</a> daemonize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">void</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Daemonize a process by fork it and exit the parent. no need to fork twice since the parent exits. </p>

</div>
</div>
<a id="a39160bd731e78e9de1768b2bed9a06d3" name="a39160bd731e78e9de1768b2bed9a06d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39160bd731e78e9de1768b2bed9a06d3">&#9670;&#160;</a></span>redirect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d44/class_num_array.html">void</a> redirect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">void</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Redirect output. If we are in detached mode, will output to file, otherwise will output to both file and screen. </p>

</div>
</div>
<a id="aa7efd3a64d0b0853540f2403f926644a" name="aa7efd3a64d0b0853540f2403f926644a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7efd3a64d0b0853540f2403f926644a">&#9670;&#160;</a></span>launch_exe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d44/class_num_array.html">pid_t</a> launch_exe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">const</a> char *&#160;</td>
          <td class="paramname"><em>exepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">const</a> char *&#160;</td>
          <td class="paramname"><em>cmd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fork and launch exe as specified in cmd. cmd should composed of the path to start the exe, exe name, and parameters. used by maos/skyc.</p>
<p>if cwd is NULL, cmd must include path information. if cwd is not NULL cmd must only contain arguments, without path information. </p>

</div>
</div>
<a id="afcabfafcc9beaed3768dca78f4183695" name="afcabfafcc9beaed3768dca78f4183695"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcabfafcc9beaed3768dca78f4183695">&#9670;&#160;</a></span>find_exe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * find_exe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">const</a> char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find an executable from predetermined locations and return the absolute path. </p>

</div>
</div>
<a id="a29e658343992b41840bc0b2f1d6d67df" name="a29e658343992b41840bc0b2f1d6d67df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29e658343992b41840bc0b2f1d6d67df">&#9670;&#160;</a></span>spawn_process()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int spawn_process </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">const</a> char *&#160;</td>
          <td class="paramname"><em>exename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">const</a> char *<a class="el" href="../../d0/d44/class_num_array.html">const</a> *&#160;</td>
          <td class="paramname"><em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d44/class_num_array.html">const</a> char *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fork twice and launch exename, with arguments args. Returns PID of the grandchild process. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->

   </ul>
 </div>
</body>
</html>
