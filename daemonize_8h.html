<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>MAOS: sys/daemonize.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="maos.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MAOS
   </div>
   <div id="projectbrief">Multithreaded Adaptive Optics Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('daemonize_8h.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">daemonize.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a11994e1abb814e3885025b3fa9088602"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="daemonize_8h.html#a11994e1abb814e3885025b3fa9088602">single_instance_daemonize</a> (const char *lockfolder_in, const char *progname, <a class="el" href="classlong.html">long</a> version, void(*daemon_func)(void *), void *daemon_arg)</td></tr>
<tr class="separator:a11994e1abb814e3885025b3fa9088602"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad10839cacf3acb84d43eae3ff6d04ade"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="daemonize_8h.html#ad10839cacf3acb84d43eae3ff6d04ade">lock_file</a> (const char *fn, <a class="el" href="classlong.html">long</a> block, <a class="el" href="classlong.html">long</a> version)</td></tr>
<tr class="separator:ad10839cacf3acb84d43eae3ff6d04ade"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29b0af1da2432bcc90721c0b62f4e660"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="daemonize_8h.html#a29b0af1da2432bcc90721c0b62f4e660">daemonize</a> (void)</td></tr>
<tr class="separator:a29b0af1da2432bcc90721c0b62f4e660"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39160bd731e78e9de1768b2bed9a06d3"><td class="memItemLeft" align="right" valign="top"><a id="a39160bd731e78e9de1768b2bed9a06d3"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>redirect</b> (void)</td></tr>
<tr class="separator:a39160bd731e78e9de1768b2bed9a06d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7efd3a64d0b0853540f2403f926644a"><td class="memItemLeft" align="right" valign="top">pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="daemonize_8h.html#aa7efd3a64d0b0853540f2403f926644a">launch_exe</a> (const char *exepath, const char *cmd)</td></tr>
<tr class="separator:aa7efd3a64d0b0853540f2403f926644a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9707696da35911195b46dff9db3531bc"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="daemonize_8h.html#a9707696da35911195b46dff9db3531bc">find_exe</a> (const char *name)</td></tr>
<tr class="separator:a9707696da35911195b46dff9db3531bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8862ff7564bee0fe564f283b1c263672"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="daemonize_8h.html#a8862ff7564bee0fe564f283b1c263672">spawn_process</a> (const char *exename, const char *arg, const char *path)</td></tr>
<tr class="separator:a8862ff7564bee0fe564f283b1c263672"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Handling process creation. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a11994e1abb814e3885025b3fa9088602"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11994e1abb814e3885025b3fa9088602">&#9670;&nbsp;</a></span>single_instance_daemonize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void single_instance_daemonize </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>lockfolder_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>progname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlong.html">long</a>&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(void *)&#160;</td>
          <td class="paramname"><em>daemon_func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>daemon_arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Launch a singleton daemon. First try to create a lock file progname.pid in folder lockfolder_in. If lock failes, it means other daemon already exists, will not proceed. If lock succeed, will write pid and version in the file.</p>
<p>the stdin and stderr stream will then be directed to progname.log in folder lockfolder_in. buffering is disabled to ensure real time display by tail.</p>
<p>if daemon_func is true, will fork and run it with argument daemon_arg. otherwise the routine returns. </p>

</div>
</div>
<a id="ad10839cacf3acb84d43eae3ff6d04ade"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad10839cacf3acb84d43eae3ff6d04ade">&#9670;&nbsp;</a></span>lock_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lock_file </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fnlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlong.html">long</a>&#160;</td>
          <td class="paramname"><em>block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlong.html">long</a>&#160;</td>
          <td class="paramname"><em>version</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Ensure exclusive access by opening and maintaining lock of file fn.</p>
<p>Will proceed if the lock if succeed, in which case non-negative number of the fd is returned. If other process already locked, will return negative number. If version is specified and is bigger than the value contained in existing fnlock, will kill the old process that created fnlock. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fnlock</td><td>The filename to lock on </td></tr>
    <tr><td class="paramname">block</td><td>block on weighting. set to 0 for no waiting. </td></tr>
    <tr><td class="paramname">version</td><td>The version of the software that locks the file, primarily for managing scheduler. May be zero. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a29b0af1da2432bcc90721c0b62f4e660"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29b0af1da2432bcc90721c0b62f4e660">&#9670;&nbsp;</a></span>daemonize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void daemonize </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Daemonize a process by fork it and exit the parent. no need to fork twice since the parent exits. </p>

</div>
</div>
<a id="aa7efd3a64d0b0853540f2403f926644a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7efd3a64d0b0853540f2403f926644a">&#9670;&nbsp;</a></span>launch_exe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pid_t launch_exe </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>exepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fork and launch exe as specified in cmd. cmd should composed of the path to start the exe, exe name, and parameters. used by maos/skyc.</p>
<p>if cwd is NULL, cmd must include path information. if cwd is not NULL cmd must only contain arguments, without path information. </p>

</div>
</div>
<a id="a9707696da35911195b46dff9db3531bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9707696da35911195b46dff9db3531bc">&#9670;&nbsp;</a></span>find_exe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* find_exe </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find an executable from predetermined locations and return the absolute path. </p>

</div>
</div>
<a id="a8862ff7564bee0fe564f283b1c263672"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8862ff7564bee0fe564f283b1c263672">&#9670;&nbsp;</a></span>spawn_process()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int spawn_process </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>exename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fork twice and launch exename, with arguments args. Returns PID of the grandchild process. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->

   </ul>
 </div>
</body>
</html>
