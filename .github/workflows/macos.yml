name: Test maos compilation in macos
#on macos, compile only.
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    if: github.repository == 'lianqiw/maos'
    runs-on: macos-latest
    
    steps:
    - name: checkout maos
      uses: actions/checkout@v4
      with:
        path: maos
    - name: autogen
      run: cd maos && ./autogen.sh
    - name: configure
      run: mkdir build && cd build && ../maos/configure --enable-release
    - name: make
      run: cd build && make
    - name: make distcheck
      run: cd build && make distcheck
      #in macos, make distcheck invokes make check
      #do not include `|| cat */test-suite.log` which got rid of the exit status
    - uses: actions/upload-artifact@v4
      with:
        name: maos-bin
        path: build/bin/
    
